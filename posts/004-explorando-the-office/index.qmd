---
title: "Explorando o mundo de The Office"
subtitle: "Uma breve manipula√ß√£o de dados"
date: "2022-10-15"
categories: [pt-br, R, The Office, tidyverse]
image: "https://media.giphy.com/media/LXfpI3nNbfCm91llsA/giphy.gif"
draft: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```


## Sobre o que √© essa postagem?

 - A melhor s√©rie de todos os tempos;
 - Importando dados da internet;
 - Coletando algumas informa√ß√µes utilizando `dplyr`.


## Hist√≥ria

Estava eu pensando sobre uma nova postagem para o blog, quando recebi no meu telefone uma notifica√ß√£o do [reddit](https://www.reddit.com/r/datasets/comments/6yt3og/every_line_from_every_episode_of_the_office_us/), com o t√≠tulo "*Every line from Every Episode of 'The Office (US)'*" -- *Todas as falas de todos os epis√≥dios do The Office (EUA)*. Sem pensar duas vezes, fui dar uma olhada.

Explicando:

Nos idos de 2009 tive a felicidade de conhecer [The Office](https://pt.wikipedia.org/wiki/The_Office_(Estados_Unidos)), que se trata de uma s√©rie de com√©dia em formato de pseudodocument√°rio exibida pela rede estadunidense NBC (No Brasil d√° pra assistir pela [prime](https://www.amazon.com.br/prime), beb√™s üòò. Esta √© minha s√©rie favorita do cora√ß√£o (ü¶Ü Boy, Camura, Sarah).

```{r}
#| label: fig-gif1
#| fig-cap: Yeah baby!
#| echo: false
#| out-width: 50%

knitr::include_graphics("https://media.giphy.com/media/IwAZ6dvvvaTtdI8SD5/giphy.gif")
```

Voltando:

Ap√≥s checar do que se tratava o banco de dados (BD), resolvi trazer pra c√°, e mexer um pouco s√≥ pra ver o que conseguimos extrair dele.

Pensei em mostrar somente uma breve manipula√ß√£o de dados agora, depois podemos  transformar essas tabelas em belos gr√°ficos üòâ.




## M√£os no computador

Por primeiro, devemos fazer o download dos dados. H√°, pelo menos, tr√™s formas diferentes de fazer isso:

1. Utilizando o pr√≥prio BD cedido pelo usu√°rio [misunderstoodpoetry](https://www.reddit.com/user/misunderstoodpoetry/).

 - Os dados est√£o em uma planilha do google sheets;
 - Para ter acesso pelo R, podemos utilizar o pacote `googlesheets4`, atrav√©s da fun√ß√£o `read_sheet()`, dessa forma:
 
```{r}
#| label: gsheets
#| eval: false

# carregando o pacote necess√°rio
library(googlesheets4) # ler diretamente do google sheets

# colocando o BD em um objeto do tipo dataframe (ou tibble)
theoffice <- read_sheet("https://docs.google.com/spreadsheets/d/18wS5AAwOh8QO95RwHLS95POmSNKA2jjzdt0phrxeAE0/edit#gid=747974534")
```

2. Utilizando o BD fornecido pelo usu√°rio [Fabrizio Cominetti](https://www.kaggle.com/fabriziocominetti), l√° no [Kaggle](https://www.kaggle.com/datasets/fabriziocominetti/the-office-lines) (em outro post trago mais detalhes sobre);

 - Podemos fazer o download do BD utilizando uma API do Kaggle, utilizando o pacote [`kaggler`](https://github.com/mkearney/kaggler);
 
3. Baixando os dados manualmente.

 - Para ler o arquivo utilizarei o pacote `readr`, da fam√≠lia `tidyverse`:
 
```{r}
#| label: readr

# carregando os pacotes necess√°rios
library(dplyr) # manipula√ß√£o de dados
library(readr) # fun√ß√£o read_csv()

# lendo o arquivo "the-office_lines.csv.zip"
theoffice <- read_csv(here::here("posts/004-explorando-the-office/the-office-lines - scripts.csv"),
					  show_col_types = FALSE)

# resumindo os dados
glimpse(theoffice)
```

Como podemos ver, o objeto `theoffice` cont√©m **7 vari√°veis** e **59.909 observa√ß√µes** (ou "falas" dos personagens). 

Para melhor visualiza√ß√£o (somente das 6 primeiras observa√ß√µes):


```{r}
knitr::kable(head(theoffice, n = 6))
```


```{r}
#| label: michael
#| echo: false
#| fig-cap: T√° bom, Michael.
	
knitr::include_graphics("https://media.giphy.com/media/5wWf7H89PisM6An8UAU/giphy.gif")
```

#### Renomeando as vari√°veis para pt-br

Agora, j√° que √© uma postagem em portugu√™s, vamos traduzir os nomes das vari√°veis.

```{r}
theoffice_pt <- theoffice %>% 
	rename(temporada = season,
		   episodio = episode,
		   cena = scene,
		   fala = line_text,
		   personagem = speaker,
		   deletado = deleted)

knitr::kable(head(theoffice_pt, n = 2))
```

Nomes das vari√°veis alteradas.

#### N√∫mero de falas por temporada

Bom, dessa vez vamos ver **quantas falas existiram em cada uma das 9 temporadas da s√©rie**:

```{r}
theoffice_pt %>% 
	# agrupando por temporada
	group_by(temporada) %>% 
	# somando as observa√ß√µes
	tally()
```

A fun√ß√£o `tally()` faz uma soma do n√∫mero de vezes que certo *grupo* aparece, dada na fun√ß√£o `group_by()`. Nesse exemplo acima, ele pega cada um dos grupos dentro de temporada, e identifica quantas observa√ß√µes h√° em cada uma.

A temporada que teve mais falas foi a **5¬™** (que, inclusive, considero a melhor!), com **8170 falas**.

#### N√∫mero de falas por personagem no 1¬∫ epis√≥dio

Podemos tamb√©m filtrar algumas informa√ß√µes, para ser mais espec√≠ficos. Por exemplo, se quisermos saber quantas **falas** foram feitas **por personagem** no **primeiro epis√≥dio** da **primeira temporada** (~~a mais odiada~~):

```{r}
theoffice_pt %>% 
	# filtramos a temporada 1 e o epis√≥dio 1
	filter(temporada == 1 & episodio == 1) %>% 
	# agrupamos por personagem
	group_by(personagem) %>% 
	# fazemos a somat√≥ria de observa√ß√µes
	tally() %>% 
	# organizando do n√∫mero maior para o menor
	arrange(desc(n))
```




## Finalizando

Acho que j√° deu pra dar uma breve ideia do que conseguimos fazer com algumas poucas fun√ß√µes, em breve vamos explorar um pouco mais esses dados, e tamb√©m brincar com visualiza√ß√µes.


```{r}
#| label: party
#| echo: false
#| fig-cap: √â festa!
	
knitr::include_graphics("https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif")
```


Nesta sess√£o apresentei os seguintes pacotes:
 
 - `dplyr`
 - `googlesheets4`
 - `readr`
 


At√© mais!

Cheers,

R.






