{
  "hash": "871395b2821d5e2a55181fe05239ad36",
  "result": {
    "markdown": "---\ntitle: \"Explorando o mundo de The Office\"\nsubtitle: \"Uma breve manipula√ß√£o de dados\"\ndate: \"2022-10-15\"\ncategories: [pt-br, R, the office, tidyverse]\nimage: \"https://media.giphy.com/media/LXfpI3nNbfCm91llsA/giphy.gif\"\ndraft: false\n---\n\n\n\n\n\n## Sobre o que √© essa postagem?\n\n - A melhor s√©rie de todos os tempos;\n - Importando dados da internet;\n - Coletando algumas informa√ß√µes utilizando `dplyr`.\n\n\n## Hist√≥ria\n\nEstava eu pensando sobre uma nova postagem para o blog, quando recebi no meu telefone uma notifica√ß√£o do [reddit](https://www.reddit.com/r/datasets/comments/6yt3og/every_line_from_every_episode_of_the_office_us/), com o t√≠tulo \"*Every line from Every Episode of 'The Office (US)'*\" -- *Todas as falas de todos os epis√≥dios do The Office (EUA)*. Sem pensar duas vezes, fui dar uma olhada.\n\nExplicando:\n\nNos idos de 2009 tive a felicidade de conhecer [The Office](https://pt.wikipedia.org/wiki/The_Office_(Estados_Unidos)), que se trata de uma s√©rie de com√©dia em formato de pseudodocument√°rio exibida pela rede estadunidense NBC (No Brasil d√° pra assistir pela [prime](https://www.amazon.com.br/prime), beb√™s üòò. Esta √© minha s√©rie favorita do cora√ß√£o (ü¶Ü Boy, Camura, Sarah).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Yeah baby!](https://media.giphy.com/media/IwAZ6dvvvaTtdI8SD5/giphy.gif){#fig-gif1 width=50%}\n:::\n:::\n\n\nVoltando:\n\nAp√≥s checar do que se tratava o banco de dados (BD), resolvi trazer pra c√°, e mexer um pouco s√≥ pra ver o que conseguimos extrair dele.\n\nPensei em mostrar somente uma breve manipula√ß√£o de dados agora, depois podemos  transformar essas tabelas em belos gr√°ficos üòâ.\n\n\n\n\n## M√£os no computador\n\nPor primeiro, devemos fazer o download dos dados. H√°, pelo menos, tr√™s formas diferentes de fazer isso:\n\n1. Utilizando o pr√≥prio BD cedido pelo usu√°rio [misunderstoodpoetry](https://www.reddit.com/user/misunderstoodpoetry/).\n\n - Os dados est√£o em uma planilha do google sheets;\n - Para ter acesso pelo R, podemos utilizar o pacote `googlesheets4`, atrav√©s da fun√ß√£o `read_sheet()`, dessa forma:\n \n\n::: {.cell}\n\n```{.r .cell-code}\n# carregando o pacote necess√°rio\nlibrary(googlesheets4) # ler diretamente do google sheets\n\n# colocando o BD em um objeto do tipo dataframe (ou tibble)\ntheoffice <- read_sheet(\"https://docs.google.com/spreadsheets/d/18wS5AAwOh8QO95RwHLS95POmSNKA2jjzdt0phrxeAE0/edit#gid=747974534\")\n```\n:::\n\n\n2. Utilizando o BD fornecido pelo usu√°rio [Fabrizio Cominetti](https://www.kaggle.com/fabriziocominetti), l√° no [Kaggle](https://www.kaggle.com/datasets/fabriziocominetti/the-office-lines) (em outro post trago mais detalhes sobre);\n\n - Podemos fazer o download do BD utilizando uma API do Kaggle, utilizando o pacote [`kaggler`](https://github.com/mkearney/kaggler);\n \n3. Baixando os dados manualmente.\n\n - Para ler o arquivo utilizarei o pacote `readr`, da fam√≠lia `tidyverse`:\n \n\n::: {.cell}\n\n```{.r .cell-code}\n# carregando os pacotes necess√°rios\nlibrary(dplyr) # manipula√ß√£o de dados\nlibrary(readr) # fun√ß√£o read_csv()\n\n# lendo o arquivo \"the-office_lines.csv.zip\"\ntheoffice <- read_csv(here::here(\"posts/004-explorando-the-office/the-office-lines - scripts.csv\"),\n\t\t\t\t\t  show_col_types = FALSE)\n\n# resumindo os dados\nglimpse(theoffice)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 59,909\nColumns: 7\n$ id        <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1‚Ä¶\n$ season    <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶\n$ episode   <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶\n$ scene     <dbl> 1, 1, 1, 1, 1, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 5, 6, 7, 7, ‚Ä¶\n$ line_text <chr> \"All right Jim. Your quarterlies look very good. How are thi‚Ä¶\n$ speaker   <chr> \"Michael\", \"Jim\", \"Michael\", \"Jim\", \"Michael\", \"Michael\", \"M‚Ä¶\n$ deleted   <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS‚Ä¶\n```\n:::\n:::\n\n\nComo podemos ver, o objeto `theoffice` cont√©m **7 vari√°veis** e **59.909 observa√ß√µes** (ou \"falas\" dos personagens). \n\nPara melhor visualiza√ß√£o (somente das 6 primeiras observa√ß√µes):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::kable(head(theoffice, n = 6))\n```\n\n::: {.cell-output-display}\n| id| season| episode| scene|line_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |speaker |deleted |\n|--:|------:|-------:|-----:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------|:-------|\n|  1|      1|       1|     1|All right Jim. Your quarterlies look very good. How are things at the library?                                                                                                                                                                                                                                                                                                                                                                                                                                      |Michael |FALSE   |\n|  2|      1|       1|     1|Oh, I told you. I couldn't close it. So...                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |Jim     |FALSE   |\n|  3|      1|       1|     1|So you've come to the master for guidance? Is this what you're saying, grasshopper?                                                                                                                                                                                                                                                                                                                                                                                                                                 |Michael |FALSE   |\n|  4|      1|       1|     1|Actually, you called me in here, but yeah.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |Jim     |FALSE   |\n|  5|      1|       1|     1|All right. Well, let me show you how it's done.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |Michael |FALSE   |\n|  6|      1|       1|     2|[on the phone] Yes, I'd like to speak to your office manager, please. Yes, hello. This is Michael Scott. I am the Regional Manager of Dunder Mifflin Paper Products. Just wanted to talk to you manager-a-manger. [quick cut scene] All right. Done deal. Thank you very much, sir. You're a gentleman and a scholar. Oh, I'm sorry. OK. I'm sorry. My mistake. [hangs up] That was a woman I was talking to, so... She had a very low voice. Probably a smoker, so... [Clears throat] So that's the way it's done. |Michael |FALSE   |\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![T√° bom, Michael.](https://media.giphy.com/media/5wWf7H89PisM6An8UAU/giphy.gif)\n:::\n:::\n\n\n#### Renomeando as vari√°veis para pt-br\n\nAgora, j√° que √© uma postagem em portugu√™s, vamos traduzir os nomes das vari√°veis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheoffice_pt <- theoffice %>% \n\trename(temporada = season,\n\t\t   episodio = episode,\n\t\t   cena = scene,\n\t\t   fala = line_text,\n\t\t   personagem = speaker,\n\t\t   deletado = deleted)\n\nknitr::kable(head(theoffice_pt, n = 2))\n```\n\n::: {.cell-output-display}\n| id| temporada| episodio| cena|fala                                                                           |personagem |deletado |\n|--:|---------:|--------:|----:|:------------------------------------------------------------------------------|:----------|:--------|\n|  1|         1|        1|    1|All right Jim. Your quarterlies look very good. How are things at the library? |Michael    |FALSE    |\n|  2|         1|        1|    1|Oh, I told you. I couldn't close it. So...                                     |Jim        |FALSE    |\n:::\n:::\n\n\nNomes das vari√°veis alteradas.\n\n#### N√∫mero de falas por temporada\n\nBom, dessa vez vamos ver **quantas falas existiram em cada uma das 9 temporadas da s√©rie**:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheoffice_pt %>% \n\t# agrupando por temporada\n\tgroup_by(temporada) %>% \n\t# somando as observa√ß√µes\n\ttally()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 √ó 2\n  temporada     n\n      <dbl> <int>\n1         1  1996\n2         2  7492\n3         3  7483\n4         4  5642\n5         5  8170\n6         6  7630\n7         7  7302\n8         8  7083\n9         9  7111\n```\n:::\n:::\n\n\nA fun√ß√£o `tally()` faz uma soma do n√∫mero de vezes que certo *grupo* aparece, dada na fun√ß√£o `group_by()`. Nesse exemplo acima, ele pega cada um dos grupos dentro de temporada, e identifica quantas observa√ß√µes h√° em cada uma.\n\nA temporada que teve mais falas foi a **5¬™** (que, inclusive, considero a melhor!), com **8170 falas**.\n\n#### N√∫mero de falas por personagem no 1¬∫ epis√≥dio\n\nPodemos tamb√©m filtrar algumas informa√ß√µes, para ser mais espec√≠ficos. Por exemplo, se quisermos saber quantas **falas** foram feitas **por personagem** no **primeiro epis√≥dio** da **primeira temporada** (~~a mais odiada~~):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheoffice_pt %>% \n\t# filtramos a temporada 1 e o epis√≥dio 1\n\tfilter(temporada == 1 & episodio == 1) %>% \n\t# agrupamos por personagem\n\tgroup_by(personagem) %>% \n\t# fazemos a somat√≥ria de observa√ß√µes\n\ttally() %>% \n\t# organizando do n√∫mero maior para o menor\n\tarrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 16 √ó 2\n   personagem                  n\n   <chr>                   <int>\n 1 Michael                    97\n 2 Pam                        46\n 3 Jim                        37\n 4 Dwight                     35\n 5 Jan                        12\n 6 Ryan                       10\n 7 Oscar                       6\n 8 Angela                      5\n 9 Roy                         5\n10 Stanley                     5\n11 Documentary Crew Member     3\n12 Todd Packer                 3\n13 Kevin                       2\n14 Phyllis                     2\n15 Man                         1\n16 Michel                      1\n```\n:::\n:::\n\n\n\n\n\n## Finalizando\n\nAcho que j√° deu pra dar uma breve ideia do que conseguimos fazer com algumas poucas fun√ß√µes, em breve vamos explorar um pouco mais esses dados, e tamb√©m brincar com visualiza√ß√µes.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![√â festa!](https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif)\n:::\n:::\n\n\n\nNesta sess√£o apresentei os seguintes pacotes:\n \n - `dplyr`\n - `googlesheets4`\n - `readr`\n \n\n\nAt√© mais!\n\nCheers,\n\nR.\n\n\n\nAdendo: O Felipe Magalh√£es me sugeriu ver quantas vezes falaram \"*That's what she said!*\" na s√©rie, n√£o aguentei de curiosidade. A√≠ est√°:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# pacote para tratar com strings, tamb√©m do tidyverse\nlibrary(stringr)\n\ntwss <- theoffice_pt %>% \n\t# filtrando as falas que cont√©m a famigerada frase\n\tfilter(str_detect(fala, \"[Tt]hat's what she said?\"))\n\nglimpse(twss)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 35\nColumns: 7\n$ id         <dbl> 2545, 2547, 5325, 6322, 6353, 7644, 8872, 9624, 10904, 1259‚Ä¶\n$ temporada  <dbl> 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,‚Ä¶\n$ episodio   <dbl> 2, 2, 10, 12, 12, 17, 21, 1, 5, 10, 12, 17, 17, 20, 22, 2, ‚Ä¶\n$ cena       <dbl> 24, 24, 2, 33, 38, 6, 22, 49, 59, 49, 41, 9, 23, 11, 68, 6,‚Ä¶\n$ fala       <chr> \"That's what she said. Pam?\", \"That's what she sai [clears ‚Ä¶\n$ personagem <chr> \"Michael\", \"Michael\", \"Michael\", \"Dwight\", \"Michael\", \"Mich‚Ä¶\n$ deletado   <lgl> FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALS‚Ä¶\n```\n:::\n:::\n\n\n**35 falas** com \"*That's what she said*\"!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntwss %>% \n\tgroup_by(personagem) %>% \n\ttally() %>% \n\tarrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 11 √ó 2\n   personagem              n\n   <chr>               <int>\n 1 Michael                23\n 2 Dwight                  3\n 3 Creed                   1\n 4 David                   1\n 5 Deposition Reporter     1\n 6 Everyone                1\n 7 Holly                   1\n 8 Jan                     1\n 9 Jim                     1\n10 Pam                     1\n11 Stanley                 1\n```\n:::\n:::\n\n\nClaro que quem mais falou foi o *Michael*, mas o VAR vai ser chamado pra checar esse banco de dados a√≠ üòÖ! \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}