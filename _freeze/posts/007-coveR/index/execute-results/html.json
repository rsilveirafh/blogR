{
  "hash": "415f660f020f242b4bcee28b3c04265d",
  "result": {
    "markdown": "---\ntitle: \"Medindo a cobertura de Dossel no R\"\nsubtitle: \"Explorando o pacote `{coveR}`\"\ndate: \"2022-06-21\"\ncategories: [coveR, ecologia, R, tags]\nimage: \"https://gitlab.com/fchianucci/coveR/-/raw/master/inst/extdata/coveR-logo_HR.png\"\ndraft: true\n---\n\n\n\n\n\n## 0. Pacotes utilizados na sessão\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(coveR)      # imagens de cobertura\nlibrary(cowplot)    # organizar plots\nlibrary(here)       # localização de arquivos\nlibrary(kableExtra) # tabelas\nlibrary(knitr)      # tabelas/imagens\nlibrary(patchwork)  # organizar plots\nlibrary(tidyverse)  # manipulação de dados\n```\n:::\n\n\n- Necessário instalar os pacotes `{EBImage}`, `{exiftoolr}` e `{coveR}`, ver abaixo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Repositório BiocManager:\ninstall.packages(\"BiocManager\")\n\n# Pacote {EBImage}\nBiocManager::install(\"EBImage\")\n\n# Pacote {exiftoolr} + instalação\ndevtools::install_github(\"JoshOBrien/exiftoolr\")\nexiftoolr::install_exiftool()\n\n# Pacote {coveR}\ndevtools::install_git(\"https://gitlab.com/fchianucci/coveR\")\n```\n:::\n\n\n\n---\n\n# 1. Dados iniciais\n\n\n### 1.1. Criar o objeto principal\n\n- Criando objeto `image`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage <- here(\"posts/007-coveR/pics/pt03_ang.png\")\n```\n:::\n\n::: {.cell layout-align=\"left\"}\n::: {.cell-output-display}\n![Imagem gerada a partir de um celular com lente angular no Ponto 03.](pics/pt03_ang.png){fig-align='left' width=640}\n:::\n:::\n\n\n\n- O canal azul é preferido porque permite um maior contraste entre os pixels do céu e do dossel\n- Isso é ilustrado a seguir:\n\n\n::: {.cell layout-align=\"left\"}\n::: {.cell-output-display}\n![Imagem gerada a partir de um celular com lente angular no Ponto 03.](index_files/figure-html/unnamed-chunk-6-1.png){fig-align='left' width=672}\n:::\n:::\n\n\n\n### 1.2. Selecionar o canal azul\n\n- Selecionar o canal azul\n- Criando objeto `img_blue`\n- Função `open_blue()` importa a imagem transformando em um raster de canal único (azul)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_blue <- open_blue(image, which.blue = 3, exif = FALSE, crop = NULL)\n```\n:::\n\n::: {.cell layout-align=\"left\"}\n::: {.cell-output-display}\n![Imagem raster feita a partir de uma banda azul.](index_files/figure-html/unnamed-chunk-8-1.png){fig-align='left' width=672}\n:::\n:::\n\n\n\n### 1.3. Classificar os pixels e criar uma imagem binária\n\n- Imagem binária onde céu (*1*) e dossel (*0*)\n- A função `thd_blue()` recebe a imagem rasterizada azul e transforma em binária\n- Utiliza a função `auto_thresh()` do pacote `{autothresholdr}` para definir o thresholding (limites) da imagem \n- O padrão é o método _\"Minimum\"_, mas existem 17 métodos diferentes que podem ser testados (<https://imagej.net/plugins/auto-threshold>)\n- Criando objetos `img_lim_min` (médoto _\"Minimum\"_) e `img_lim_def` (método _\"Default\"_)\n\n\n::: {.cell layout-align=\"left\"}\n\n```{.r .cell-code}\nimg_lim_min <- thd_blue(img_blue, method = \"Minimum\", display = TRUE)\n```\n\n::: {.cell-output-display}\n![Imagem binária feita com o método \"Minimum\".](index_files/figure-html/unnamed-chunk-9-1.png){fig-align='left' width=672}\n:::\n:::\n\n::: {.cell layout-align=\"left\"}\n\n```{.r .cell-code}\nimg_lim_def <- thd_blue(img_blue, method = \"Default\", display = TRUE)\n```\n\n::: {.cell-output-display}\n![Imagem binária feita com o método \"Default\".](index_files/figure-html/unnamed-chunk-10-1.png){fig-align='left' width=672}\n:::\n:::\n\n\n\n### 1.4. Segmentar e nomear as lacunas\n\n- Retornar os atributos do dossel requer uma classificação dos pixels (os valores *1* no raster binário)\n    - largos: lacunas entre o dossel\n    - pequenos: lacunas dentro do dossel\n- A função `label_gaps()` usa a função `bwlabel()` do pacote `{EBImage}` para atribuir um valor numérico para cada lacuna distinta\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_min_gaps <- label_gaps(img_lim_min)\n```\n:::\n\n::: {.cell layout-align=\"left\"}\n::: {.cell-output-display}\n![Minimum](index_files/figure-html/unnamed-chunk-12-1.png){fig-align='left' width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_def_gaps <- label_gaps(img_lim_def)\n```\n:::\n\n::: {.cell layout-align=\"left\"}\n::: {.cell-output-display}\n![Default](index_files/figure-html/unnamed-chunk-14-1.png){fig-align='left' width=672}\n:::\n:::\n\n\n\n### 1.5. Classificar lacunas baseadas no tamanho\n\nExistem basicamente dois métodos para classificar as lacunas a depender do seus tamanhos.\n\n- [Macfarlane et al., 2007](https://doi.org/10.1016/j.agrformet.2007.05.001)\n    - Considera lacunas grandes aquelas com 1,3% da área da imagem.\n- [Alivernini et al., 2018](https://doi.org/10.1007/s00468-018-1666-3)\n    - Se baseia na distribuição estatística do tamanho das lacunas dentro da imagem.\n    - Lacunas grandes são consideradas por $gL \\ge \\mu + \\sqrt{{\\sigma \\over n}}$\n    - Comparado ao método anterior, este é dependente da densidade do dossel, já que o limite das lacunas grandes vão variar a cada imagem.\n    \nOs métodos são implementados na função `extract_gap()`:\n\n- Método _\"Minimum\"_\n\n::: {.cell}\n\n```{.r .cell-code}\n# Macfarlane\ndf_min_mac <- extract_gap(img_min_gaps, gapmethod = \"macfarlane\")\nkable(head(df_min_mac))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> id </th>\n   <th style=\"text-align:left;\"> Var1 </th>\n   <th style=\"text-align:right;\"> Freq </th>\n   <th style=\"text-align:right;\"> NR </th>\n   <th style=\"text-align:left;\"> gL </th>\n   <th style=\"text-align:left;\"> gapmethod </th>\n   <th style=\"text-align:right;\"> thd </th>\n   <th style=\"text-align:left;\"> method </th>\n   <th style=\"text-align:left;\"> channel </th>\n   <th style=\"text-align:left;\"> FileSize </th>\n   <th style=\"text-align:left;\"> Camera </th>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:left;\"> ImageSize </th>\n   <th style=\"text-align:left;\"> Date </th>\n   <th style=\"text-align:left;\"> day </th>\n   <th style=\"text-align:left;\"> month </th>\n   <th style=\"text-align:left;\"> year </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:right;\"> 796127 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Canopy </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n# Alivernini\ndf_min_ali <- extract_gap(img_min_gaps, gapmethod = \"alivernini\")\nkable(head(df_min_ali))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> id </th>\n   <th style=\"text-align:left;\"> Var1 </th>\n   <th style=\"text-align:right;\"> Freq </th>\n   <th style=\"text-align:right;\"> NR </th>\n   <th style=\"text-align:left;\"> gL </th>\n   <th style=\"text-align:right;\"> gMN </th>\n   <th style=\"text-align:right;\"> gSD </th>\n   <th style=\"text-align:right;\"> gN </th>\n   <th style=\"text-align:right;\"> gTHD </th>\n   <th style=\"text-align:left;\"> gapmethod </th>\n   <th style=\"text-align:left;\"> thd </th>\n   <th style=\"text-align:left;\"> method </th>\n   <th style=\"text-align:left;\"> channel </th>\n   <th style=\"text-align:left;\"> FileSize </th>\n   <th style=\"text-align:left;\"> Camera </th>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:left;\"> ImageSize </th>\n   <th style=\"text-align:left;\"> Date </th>\n   <th style=\"text-align:left;\"> day </th>\n   <th style=\"text-align:left;\"> month </th>\n   <th style=\"text-align:left;\"> year </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:right;\"> 796127 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Canopy </td>\n   <td style=\"text-align:right;\"> 796127.0000 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n- Método _\"Default\"_\n\n::: {.cell}\n\n```{.r .cell-code}\n# Macfarlane\ndf_def_mac <- extract_gap(img_def_gaps, gapmethod = \"macfarlane\")\nkable(head(df_min_mac))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> id </th>\n   <th style=\"text-align:left;\"> Var1 </th>\n   <th style=\"text-align:right;\"> Freq </th>\n   <th style=\"text-align:right;\"> NR </th>\n   <th style=\"text-align:left;\"> gL </th>\n   <th style=\"text-align:left;\"> gapmethod </th>\n   <th style=\"text-align:right;\"> thd </th>\n   <th style=\"text-align:left;\"> method </th>\n   <th style=\"text-align:left;\"> channel </th>\n   <th style=\"text-align:left;\"> FileSize </th>\n   <th style=\"text-align:left;\"> Camera </th>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:left;\"> ImageSize </th>\n   <th style=\"text-align:left;\"> Date </th>\n   <th style=\"text-align:left;\"> day </th>\n   <th style=\"text-align:left;\"> month </th>\n   <th style=\"text-align:left;\"> year </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:right;\"> 796127 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Canopy </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:left;\"> macfarlane </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n# Alivernini\ndf_def_ali <- extract_gap(img_def_gaps, gapmethod = \"alivernini\")\nkable(head(df_min_ali))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> id </th>\n   <th style=\"text-align:left;\"> Var1 </th>\n   <th style=\"text-align:right;\"> Freq </th>\n   <th style=\"text-align:right;\"> NR </th>\n   <th style=\"text-align:left;\"> gL </th>\n   <th style=\"text-align:right;\"> gMN </th>\n   <th style=\"text-align:right;\"> gSD </th>\n   <th style=\"text-align:right;\"> gN </th>\n   <th style=\"text-align:right;\"> gTHD </th>\n   <th style=\"text-align:left;\"> gapmethod </th>\n   <th style=\"text-align:left;\"> thd </th>\n   <th style=\"text-align:left;\"> method </th>\n   <th style=\"text-align:left;\"> channel </th>\n   <th style=\"text-align:left;\"> FileSize </th>\n   <th style=\"text-align:left;\"> Camera </th>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:left;\"> ImageSize </th>\n   <th style=\"text-align:left;\"> Date </th>\n   <th style=\"text-align:left;\"> day </th>\n   <th style=\"text-align:left;\"> month </th>\n   <th style=\"text-align:left;\"> year </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:right;\"> 796127 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Canopy </td>\n   <td style=\"text-align:right;\"> 796127.0000 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pt03_ang.png </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1228800 </td>\n   <td style=\"text-align:left;\"> Small_gap </td>\n   <td style=\"text-align:right;\"> 114.4335 </td>\n   <td style=\"text-align:right;\"> 5130.79 </td>\n   <td style=\"text-align:right;\"> 3781 </td>\n   <td style=\"text-align:right;\"> 197.8748 </td>\n   <td style=\"text-align:left;\"> alivernini </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Minimum </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n### 1.6. Recuperar atributos do dossel\n\n- Função `get_canopy()` para estimar os atributos do dossel.\n- Dentre eles:\n    - **Fração das Lacunas** ($FL$) = fração dos pixels das lacunas (nomeados por *1* na imagem binária): $FL = {Tp \\over Np}$, onde $Tp$ é o número de pixels de lacuna, $Np$ é o número total de pixels;\n    - **Cobertura Foliar** ($CF$) = complemento da fração das lacunas: $CF = {1 - FL}$;\n    - **Cobertura do Dossel** ($CD$) = complemento da fração das lacunas grandes: $CD = 1 - {Tp \\over Np}$;\n    - **Porosidade do Dossel** ($PD$) = fração das lacunas dentro dos dosséis: $PD = 1 - {CF \\over CD}$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2 <- get_canopy(df1, k = 0.85)\n\ncnp.img <- canopy_raster(img3, df1)\n\nraster::plot(cnp.img)\n\nout <- coveR(image, \n             which.blue = 3, \n             method = \"Minimum\",\n             gapmethod = \"alivernini\",\n             k = 0.8, \n             export.image = FALSE, \n             exif = FALSE, \n             crop = NULL)\n\nout\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimages <- dir(path = here(\"posts/007-coveR/pics/\"), pattern = \"*.png\", full.names = TRUE)\n\nhere::here()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"/home/ricardo/Documents/git/blogR\"\n```\n:::\n\n```{.r .cell-code}\nimages |> \n    purrr::map(coveR, method = \"Minimum\", gapmethod = \"macfarlane\") |> \n    dplyr::bind_rows()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   id        FC        CC         CP        Le         L\n1   pt03_ang_blue.png 0.7867985 0.9314966 0.15533936 3.0910351 3.4691600\n2  pt03_ang_green.png 0.8047005 0.9347078 0.13908873 3.2664422 3.6876902\n3    pt03_ang_red.png 0.5600220 0.6743522 0.16954084 1.6420610 2.3934937\n4        pt03_ang.png 0.6478898 0.7132389 0.09162304 2.0876222 3.4093855\n5     pt03_normal.png 0.1219629 0.1371821 0.11094149 0.2601328 0.6032588\n6        pt10_ang.png 0.9079427 0.9834237 0.07675324 4.7706883 5.0492110\n7     pt10_normal.png 0.9001671 1.0000000 0.09983290 4.6085150 4.6085150\n8        pt12_ang.png 0.8985213 1.0000000 0.10147868 4.5758131 4.5758131\n9     pt12_normal.png 0.9081239 1.0000000 0.09187609 4.7746290 4.7746290\n10       pt20_ang.png 0.6560661 0.7758553 0.15439635 2.1346115 2.8989559\n11    pt20_normal.png 0.5302192 0.6309549 0.15965592 1.5109781 2.3152690\n          CI   k  gapmethod   thd  method channel FileSize Camera Model\n1  0.8910039 0.5 macfarlane 0.013 Minimum       3   770461   <NA>  <NA>\n2  0.8857692 0.5 macfarlane 0.013 Minimum       3  1424666   <NA>  <NA>\n3  0.6860519 0.5 macfarlane 0.013 Minimum       3  1159745   <NA>  <NA>\n4  0.6123163 0.5 macfarlane 0.013 Minimum       3  1974863   <NA>  <NA>\n5  0.4312127 0.5 macfarlane 0.013 Minimum       3   404219   <NA>  <NA>\n6  0.9448384 0.5 macfarlane 0.013 Minimum       3  2543367   <NA>  <NA>\n7  1.0000000 0.5 macfarlane 0.013 Minimum       3  2239355   <NA>  <NA>\n8  1.0000000 0.5 macfarlane 0.013 Minimum       3  2353004   <NA>  <NA>\n9  1.0000000 0.5 macfarlane 0.013 Minimum       3  2032940   <NA>  <NA>\n10 0.7363380 0.5 macfarlane 0.013 Minimum       3  2374501   <NA>  <NA>\n11 0.6526145 0.5 macfarlane 0.013 Minimum       3  1660670   <NA>  <NA>\n   ImageSize Date  day month year\n1   1280 960 <NA> <NA>  <NA> <NA>\n2   1280 960 <NA> <NA>  <NA> <NA>\n3   1280 960 <NA> <NA>  <NA> <NA>\n4   1280 960 <NA> <NA>  <NA> <NA>\n5   1280 720 <NA> <NA>  <NA> <NA>\n6   960 1280 <NA> <NA>  <NA> <NA>\n7   720 1280 <NA> <NA>  <NA> <NA>\n8   1280 960 <NA> <NA>  <NA> <NA>\n9   1280 720 <NA> <NA>  <NA> <NA>\n10  1280 960 <NA> <NA>  <NA> <NA>\n11  1280 720 <NA> <NA>  <NA> <NA>\n```\n:::\n:::\n\n\n\n\n\n\n\n\n# References\n\n\nCraig Macfarlane, Andrew Grigg, Crystelle Evangelista,\nEstimating forest leaf area using cover and fullframe fisheye photography: Thinking inside the circle,\nAgricultural and Forest Meteorology,\nVolume 146, Issues 1–2,\n2007,\nPages 1-12\n\n\nAlivernini, A., Fares, S., Ferrara, C. et al. An objective image analysis method for estimation of canopy attributes from digital cover photography. Trees 32, 713–723 (2018). \n\nChianucci et al. 2022. \"coveR: an R package for processing digital cover photography images to retrieve forest canopy attributes.\" Trees (2022): 1-10.\n\n- Link: <https://link.springer.com/article/10.1007/s00468-022-02338-5>\n- GitLab: <https://gitlab.com/fchianucci/coveR>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}